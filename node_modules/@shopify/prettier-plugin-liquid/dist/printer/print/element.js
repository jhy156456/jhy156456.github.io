'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.printElement = exports.printRawElement = void 0;
const prettier_1 = require("prettier");
const utils_1 = require("../../printer/utils");
const tag_1 = require("../../printer/print/tag");
const children_1 = require("../../printer/print/children");
const types_1 = require("../../types");
const parser_1 = require("../../parser");
const { builders: { breakParent, dedentToRoot, group, indent, hardline, line, softline, }, } = prettier_1.doc;
const { replaceTextEndOfLine } = prettier_1.doc.utils;
function printRawElement(path, options, print, _args) {
    const node = path.getValue();
    const attrGroupId = Symbol('element-attr-group-id');
    let body = [];
    const hasEmptyBody = node.body.value.trim() === '';
    const shouldIndentBody = node.body.kind !== parser_1.RawMarkupKinds.markdown;
    if (!hasEmptyBody) {
        if (shouldIndentBody) {
            body = [indent([hardline, path.call(print, 'body')]), hardline];
        }
        else {
            body = [dedentToRoot([hardline, path.call(print, 'body')]), hardline];
        }
    }
    return group([
        (0, tag_1.printOpeningTagPrefix)(node, options),
        group((0, tag_1.printOpeningTag)(path, options, print, attrGroupId), {
            id: attrGroupId,
        }),
        ...body,
        ...(0, tag_1.printClosingTag)(node, options),
        (0, tag_1.printClosingTagSuffix)(node, options),
    ]);
}
exports.printRawElement = printRawElement;
function printElement(path, options, print, args) {
    const node = path.getValue();
    const attrGroupId = Symbol('element-attr-group-id');
    const elementGroupId = Symbol('element-group-id');
    if (node.type === types_1.NodeTypes.HtmlRawNode) {
        return printRawElement(path, options, print, args);
    }
    if ((0, utils_1.hasNoCloseMarker)(node)) {
        return [
            group((0, tag_1.printOpeningTag)(path, options, print, attrGroupId), {
                id: attrGroupId,
            }),
            ...(0, tag_1.printClosingTag)(node, options),
            (0, tag_1.printClosingTagSuffix)(node, options),
        ];
    }
    if ((0, utils_1.shouldPreserveContent)(node)) {
        return [
            (0, tag_1.printOpeningTagPrefix)(node, options),
            group((0, tag_1.printOpeningTag)(path, options, print, attrGroupId), {
                id: attrGroupId,
            }),
            ...replaceTextEndOfLine((0, tag_1.getNodeContent)(node, options)),
            ...(0, tag_1.printClosingTag)(node, options),
            (0, tag_1.printClosingTagSuffix)(node, options),
        ];
    }
    const printTag = (doc) => group([
        group((0, tag_1.printOpeningTag)(path, options, print, attrGroupId), {
            id: attrGroupId,
        }),
        doc,
        (0, tag_1.printClosingTag)(node, options),
    ], { id: elementGroupId });
    const printLineBeforeChildren = () => {
        if (node.firstChild.hasLeadingWhitespace &&
            node.firstChild.isLeadingWhitespaceSensitive) {
            return line;
        }
        if (node.firstChild.type === types_1.NodeTypes.TextNode &&
            node.isWhitespaceSensitive &&
            node.isIndentationSensitive) {
            return dedentToRoot(softline);
        }
        return softline;
    };
    const printLineAfterChildren = () => {
        const needsToBorrow = node.next
            ? (0, tag_1.needsToBorrowPrevClosingTagEndMarker)(node.next)
            : (0, tag_1.needsToBorrowLastChildClosingTagEndMarker)(node.parentNode);
        if (needsToBorrow) {
            if (node.lastChild.hasTrailingWhitespace &&
                node.lastChild.isTrailingWhitespaceSensitive) {
                return ' ';
            }
            return '';
        }
        if (node.lastChild.hasTrailingWhitespace &&
            node.lastChild.isTrailingWhitespaceSensitive) {
            return line;
        }
        return softline;
    };
    if (node.children.length === 0) {
        return printTag(node.hasDanglingWhitespace && node.isDanglingWhitespaceSensitive
            ? line
            : '');
    }
    return printTag([
        (0, utils_1.forceBreakContent)(node) ? breakParent : '',
        indent([
            printLineBeforeChildren(),
            (0, children_1.printChildren)(path, options, print, {
                leadingSpaceGroupId: elementGroupId,
                trailingSpaceGroupId: elementGroupId,
            }),
        ]),
        printLineAfterChildren(),
    ]);
}
exports.printElement = printElement;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wcmludGVyL3ByaW50L2VsZW1lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7QUFFYix1Q0FBNkM7QUFDN0MsMkNBSXlCO0FBQ3pCLDZDQVE2QjtBQUM3Qix1REFBeUQ7QUFDekQsbUNBT2lCO0FBQ2pCLHFDQUEwQztBQUUxQyxNQUFNLEVBQ0osUUFBUSxFQUFFLEVBQ1IsV0FBVyxFQUNYLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUNOLFFBQVEsRUFDUixJQUFJLEVBQ0osUUFBUSxHQUNULEdBQ0YsR0FBRyxjQUFHLENBQUM7QUFDUixNQUFNLEVBQUUsb0JBQW9CLEVBQUUsR0FBRyxjQUFHLENBQUMsS0FBWSxDQUFDO0FBRWxELFNBQWdCLGVBQWUsQ0FDN0IsSUFBMEIsRUFDMUIsT0FBNEIsRUFDNUIsS0FBb0IsRUFDcEIsS0FBd0I7SUFFeEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzdCLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0lBQ3BELElBQUksSUFBSSxHQUFRLEVBQUUsQ0FBQztJQUNuQixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUM7SUFDbkQsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyx1QkFBYyxDQUFDLFFBQVEsQ0FBQztJQUVwRSxJQUFJLENBQUMsWUFBWSxFQUFFO1FBQ2pCLElBQUksZ0JBQWdCLEVBQUU7WUFDcEIsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztTQUNq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